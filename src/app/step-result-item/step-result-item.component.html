<div class="form-group" >
  <div class="col-sm-1">
    <span class="glyphicon glyphicon-ok-circle" style="color: green;" *ngIf="stepResult.result == 'OK'"></span>
    <span class="glyphicon glyphicon-remove-circle" style="color: red;" *ngIf="stepResult.result != 'OK'"></span>
    {{stepResult.result}}
  </div>
  <div style="color: gray;" class="col-sm-11">{{stepResult.step.stepComment}} {{stepResult.description}}</div>
  <div class="clearfix"></div>
  <div class="col-sm-11 col-sm-offset-1">
    {{stepResult.step.requestMethod}}
    {{stepResult.requestUrl}}
  </div>
  <div class="clearfix"></div>
  <div class="col-sm-11 col-sm-offset-1">
    <ul class="nav nav-tabs">
      <li [class.active]="tab == 'summary'"><a href="#" (click)="selectTab('summary')">Summary</a></li>
      <li [class.active]="tab == 'details'"><a href="#" (click)="selectTab('details')">Details</a></li>
      <li [class.active]="tab == 'stepEdit'"><a href="#" (click)="selectTab('stepEdit')">Edit step</a></li>
      <li [class.active]="tab == 'json'"><a href="#" (click)="selectTab('json')">json</a></li>
    </ul>
    <div class="tab-content" style="padding: 10px;">
      <div class="help-block" *ngIf="tab == 'summary' || tab == 'all'">
        Test id: {{stepResult.testId}}
      </div>
      <div *ngIf="tab == 'details' || tab == 'all'">
        <div class="row">
          <div class="col-sm-12" style="color: gray;">
            <div *ngIf="stepResult.pollingRetryCount > 1">Polling retry count: {{stepResult.pollingRetryCount}}</div>
            Saved parameters: {{stepResult.savedParameters}}
          </div>
          <div class="clearfix"></div>
          <div class="col-sm-12">
            <label>Request body</label>
            <div class="form-control" style="overflow: scroll; height: 180px; white-space: pre; background-color: #eee;">{{stepResult.requestBody}}</div>
          </div>
          <div class="clearfix"></div>
          <div class="col-sm-6">
            <label>Actual</label>
            <div class="form-control"
                 #actualResult
                 style="overflow: scroll; height: 180px; background-color: #eee;"
                 [appSyncScroll]="expectedResult">
              <ng-container *ngTemplateOutlet="diffActual"></ng-container>
            </div>
          </div>
          <div class="col-sm-6">
            <label>Expected</label>
            <div class="form-control"
                 #expectedResult
                 style="overflow: scroll; height: 180px; background-color: #eee;"
                 [appSyncScroll]="actualResult">
              <ng-container *ngTemplateOutlet="diffExpected"></ng-container>
            </div>
          </div>
          <div class="col-sm-12" style="color: gray;">
            <label>Details</label>
            <pre>{{stepResult.details}}</pre>
          </div>
        </div>
      </div>
      <div *ngIf="tab == 'json' || tab == 'all'">
        <pre>{{stepResult | json}}</pre>
      </div>
      <div *ngIf="tab == 'stepEdit' || tab == 'all'">
        <app-step-item [step]="stepResult.step"></app-step-item>
        <button class="btn btn-xs btn-success" (click)="saveStep()">Save step</button>
      </div>
    </div>
  </div>
</div>

<ng-template #diffActual>
  <div *ngFor="let item of diff" [class.added-row]="item.added">
    <ng-container *ngIf="!item.removed && item.rowDiff">
      <span
        *ngFor="let rowItem of item.rowDiff"
        class="diff-content"
        [class.added]="rowItem.added">{{!rowItem.removed ? rowItem.value : ''}}</span>
    </ng-container>
    <ng-container *ngIf="!item.removed && !item.rowDiff">
      <span class="diff-content" [class.added]="item.added">{{!item.removed ? item.value : ''}}</span>
    </ng-container>
  </div>
</ng-template>

<ng-template #diffExpected>
  <div *ngFor="let item of diff" [class.removed-row]="item.removed">
    <ng-container *ngIf="!item.added && item.rowDiff">
      <span
        *ngFor="let rowItem of item.rowDiff"
        class="diff-content"
        [class.removed]="rowItem.removed">{{!rowItem.added ? rowItem.value : ''}}</span>
    </ng-container>
    <ng-container *ngIf="!item.added && !item.rowDiff">
      <span class="diff-content" [class.removed]="item.removed">{{!item.added ? item.value : ''}}</span>
    </ng-container>
  </div>
</ng-template>
