<div class="container-fluid" style="padding-bottom: 30px;">
  <div class="row">
    <div class="col-sm-10">
      <input style="font-weight: bold; border-width: 0; box-shadow: none;" placeholder="{{'Step description' | translate}}" class="form-control" title="" [(ngModel)]="step.stepComment" />
    </div>
    <div class="col-sm-1">
      <input style="padding: 6px 1px;" placeholder="{{'Timeout (ms)' | translate}}" class="form-control" title="" [(ngModel)]="step.timeoutMs" />
    </div>
    <div class="col-sm-1 text-right" *ngIf="showUpDownDeleteCloneButtons">
      <button class="btn btn-xs btn-block btn-default" (click)="upStep()"><span class="glyphicon glyphicon-hand-up"></span> {{'Up' | translate}}</button>
      <div class="clearfix"></div>
      <button class="btn btn-xs btn-block btn-default" (click)="downStep()"><span class="glyphicon glyphicon-hand-down"></span> {{'Down' | translate}}</button>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <div class="input-group">
        <div class="input-group-btn">
          <select class="form-control" title="{{'Request method' | translate}}" [(ngModel)]="step.requestMethod">
            <option [ngValue]="''"></option>
            <option [ngValue]="'POST'">POST</option>
            <option [ngValue]="'GET'">GET</option>
            <option [ngValue]="'PUT'">PUT</option>
            <option [ngValue]="'DELETE'">DELETE</option>
          </select>
        </div>
        <input placeholder="{{'Relative url. Example' | translate}}: /relative/url?parameter=value" class="form-control" title="" [(ngModel)]="step.relativeUrl" />
        <div class="input-group-btn">
          <button class="btn btn-default" title="{{'Delete' | translate}}" *ngIf="showUpDownDeleteCloneButtons" (click)="deleteStep()"><span class="glyphicon glyphicon-minus"></span> {{'Delete' | translate}}</button>
          <button class="btn btn-default" title="{{'Disabled toggle' | translate}}" *ngIf="!step.disabled" (click)="disabledToggle()"><span class="glyphicon glyphicon-flag"></span> {{'Disable' | translate}}</button>
          <button class="btn btn-default" title="{{'Disabled toggle' | translate}}" style="color: red;" *ngIf="step.disabled" (click)="disabledToggle()"><span class="glyphicon glyphicon-flag"></span> {{'Disabled' | translate}}</button>
          <button class="btn btn-success" title="{{'Clone' | translate}}" *ngIf="showUpDownDeleteCloneButtons && step.code" (click)="cloneStep()"><span class="glyphicon glyphicon-paste"></span> {{'Clone' | translate}}</button>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <ul class="nav nav-tabs">
        <li [class.active]="tab == 'summary'"><a href="#" (click)="selectTab('summary')">{{'Summary' | translate}}</a></li>
        <li [class.active]="tab == 'details'"><a href="#" (click)="selectTab('details')">{{'Details' | translate}}</a></li>
        <li [class.active]="tab == 'scenarioVariables'">
          <a href="#" (click)="selectTab('scenarioVariables')">{{'Scenario variables' | translate}} <span *ngIf="step.jsonXPath || (step.savedValuesCheck && Object.keys(step.savedValuesCheck).length)" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'headers'">
          <a href="#" (click)="selectTab('headers')">{{'Headers' | translate}} <span *ngIf="step.requestHeaders" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'sql'">
          <a href="#" (click)="selectTab('sql')">Sql <span *ngIf="step.sql || step.sqlSavedParameter" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'mockServiceResponse'">
          <a href="#" (click)="selectTab('mockServiceResponse')">{{'Mock responses' | translate}} <span *ngIf="step.mockServiceResponseList && step.mockServiceResponseList.length != 0" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'expectedServiceRequestList'">
          <a href="#" (click)="selectTab('expectedServiceRequestList')">{{'Expected mock requests' | translate}} <span *ngIf="step.expectedServiceRequestList && step.expectedServiceRequestList.length != 0" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'mq'">
          <a href="#" (click)="selectTab('mq')">{{'Message Queue' | translate}} <span *ngIf="step.mqName || step.mqMessage" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'mqMockResponseList'">
          <a href="#" (click)="selectTab('mqMockResponseList')">{{'MQ mock responses' | translate}} <span *ngIf="step.mqMockResponseList && step.mqMockResponseList.length > 0" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'expectedMqRequests'">
          <a href="#" (click)="selectTab('expectedMqRequests')">{{'Expected MQ requests' | translate}} <span *ngIf="step.expectedMqRequestList && step.expectedMqRequestList.length > 0" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'polling'">
          <a href="#" (click)="selectTab('polling')">{{'Polling' | translate}} <span *ngIf="step.usePolling" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'parameterSet'">
          <a href="#" (click)="selectTab('parameterSet')">{{'Test cases' | translate}} <span *ngIf="step.stepParameterSetList && step.stepParameterSetList.length != 0" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'script'">
          <a href="#" (click)="selectTab('script')">{{'Script' | translate}} <span *ngIf="step.script" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'parse-mock-requests'">
          <a href="#" (click)="selectTab('parse-mock-requests')">{{'Parse mock requests' | translate}} <span *ngIf="step.parseMockRequestUrl" class="glyphicon glyphicon-tag"></span></a>
        </li>
        <li [class.active]="tab == 'json'"><a href="#" (click)="selectTab('json')">json</a></li>
      </ul>
      <div class="tab-content" style="padding: 10px;">
        <div class="row" *ngIf="tab == 'summary'">
          <div class="col-sm-6">
            <textarea title="{{'Request body' | translate}}" class="form-control" rows="5" [(ngModel)]="step.request"></textarea>
          </div>
          <div class="col-sm-6">
            <textarea title="{{'Expected response' | translate}}" class="form-control" rows="5" [(ngModel)]="step.expectedResponse"></textarea>
          </div>
        </div>
        <div *ngIf="tab == 'script' || tab == 'all'">
          <label>{{'Script' | translate}}:</label>
          <textarea placeholder="" rows="6" title="{{'Script' | translate}}" class="form-control" [(ngModel)]="step.script"></textarea>
          <div class="help-block">
            <pre>stepStatus.exception - String. Если поле заполнено, то возникнет ошибка с указанным в поле текстом.<br/>scenarioVariables - Map. Список всех переменных сценария, доступны чтение и запись.<br/>response.statusCode - int. Код ответа.<br/>response.content - String. Содержимое ответа.<br/>response.headers - Map. Заголовки ответа. Пример: response.headers['header-name'][0]<br/>Пример сохранения заголовка в переменную:<br/>scenarioVariables.MY_VARIABLE = response.headers.get('header-name')[0];</pre>
          </div>
        </div>
        <div class="row" *ngIf="tab == 'details' || tab == 'all'">
          <div class="col-sm-6">
            <div class="row">
              <div class="col-sm-6">
                <label>{{'Request body type' | translate}}</label>
                <select class="form-control" title="{{'Request body type' | translate}}" [(ngModel)]="step.requestBodyType">
                  <option [ngValue]="'JSON'">{{'JSON request body (default)' | translate}}</option>
                  <option [ngValue]="'FORM'">{{'FORM-data request body' | translate}}</option>
                </select>
              </div>
              <div class="col-sm-3">
                <label>{{'Number of repetitions' | translate}}</label>
                <input title="" placeholder="N or variable" class="form-control" [(ngModel)]="step.numberRepetitions"/>
              </div>
              <div class="col-sm-3" style="text-align: center; padding-top: 10px;">
                <label>
                  <input title="" type="checkbox" [(ngModel)]="step.expectedResponseIgnore"><br/>
                  {{'Ignore response' | translate}}
                </label>
              </div>
            </div>
            <label>{{'Request body' | translate}}</label>
            <div *ngIf="step.requestBodyType != 'FORM'">
              <textarea title="{{'Request body' | translate}}" class="form-control" rows="10" [(ngModel)]="step.request"></textarea>
            </div>
            <div *ngIf="step.requestBodyType == 'FORM'">
              <label>
                <input title="" type="checkbox" [(ngModel)]="step.multipartFormData">
                {{'multipart/form-data' | translate}}
              </label>
              <div class="clearfix"></div>
              <div *ngFor="let formData of step.formDataList" class="request-body-field">
                <input class="form-control request-body-field__name" placeholder="{{'Field name' | translate}}" title="" [(ngModel)]="formData.fieldName"/>
                <select class="form-control request-body-field__type" title="{{'Field type' | translate}}" [(ngModel)]="formData.fieldType">
                  <option [ngValue]="'TEXT'">{{'Text (default)' | translate}}</option>
                  <option [ngValue]="'FILE'">{{'File' | translate}}</option>
                </select>
                <ng-container *ngIf="formData.fieldType == 'FILE'">
                  <input class="form-control" placeholder="{{'File path' | translate}}" title="" [(ngModel)]="formData.filePath"/>
                  <input class="form-control" placeholder="{{'MIME type' | translate}}" title="" [(ngModel)]="formData.mimeType"/>
                </ng-container>
                <input class="form-control" *ngIf="formData.fieldType != 'FILE'" placeholder="{{'Field value' | translate}}" title="" [(ngModel)]="formData.value"/>
                <button class="btn btn-default request-body-field__remove" (click)="removeFormData(formData)">-</button>
              </div>
              <button class="btn" style="margin-top: 7px; margin-left: 7px;" (click)="addFormData()">{{'Add field' | translate}}</button>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="row">
              <div class="col-sm-4">
                <label>{{'Expected status' | translate}}</label>
                <input title="" placeholder="Example: 200, 404, 500, [empty]" class="form-control" [(ngModel)]="step.expectedStatusCode"/>
              </div>
              <div class="col-sm-4">
                <label>{{'Compare mode' | translate}}</label>
                <select class="form-control" title="{{'Request body type' | translate}}" [(ngModel)]="step.responseCompareMode">
                  <option [ngValue]="'JSON'">JSON (default)</option>
                  <option [ngValue]="'FULL_MATCH'">Full match</option>
                  <option [ngValue]="'IGNORE_MASK'">Mask *ignore*</option>
                </select>
              </div>
              <div class="col-sm-4" *ngIf="step.responseCompareMode == 'JSON'">
                <label>{{'JSON compare mode' | translate}}</label>
                <select class="form-control" title="{{'JSON compare mode' | translate}}" [(ngModel)]="step.jsonCompareMode">
                  <option [ngValue]="'NON_EXTENSIBLE'">NON_EXTENSIBLE (Default. Not extensible, non-strict array ordering)</option>
                  <option [ngValue]="'STRICT'">STRICT (Not extensible, strict array ordering)</option>
                  <option [ngValue]="'LENIENT'">LENIENT (Extensible, non-strict array ordering)</option>
                  <option [ngValue]="'STRICT_ORDER'">STRICT_ORDER (Extensible, strict array ordering)</option>
                </select>
              </div>
            </div>
            <label>{{'Expected response' | translate}}</label>
            <textarea title="{{'Expected response' | translate}}" class="form-control" rows="10" [(ngModel)]="step.expectedResponse"></textarea>
          </div>
        </div>
        <div *ngIf="tab == 'scenarioVariables' || tab == 'all'">
          <div class="row">
            <div class="col-sm-6">
              <label>{{'Expected response' | translate}}</label>
              <textarea title="{{'Expected response' | translate}}" class="form-control" rows="13" [(ngModel)]="step.expectedResponse"></textarea>
            </div>
            <div class="col-sm-6">
              <label>{{'Scenario variables' | translate}} (JSON XPath):</label>
              <textarea placeholder="parameterName = $.element.items[2].title" rows="13" title="{{'Request headers' | translate}}" class="form-control" [(ngModel)]="step.jsonXPath"></textarea>
            </div>
          </div>
        </div>
        <div *ngIf="tab == 'headers' || tab == 'all'">
          <label>{{'Request headers' | translate}}:</label>
          <textarea placeholder="HeaderName: headerValue" rows="5" title="{{'Request headers' | translate}}" class="form-control" [(ngModel)]="step.requestHeaders"></textarea>
        </div>
        <div *ngIf="tab == 'sql' || tab == 'all'">
          <label>{{'Sql parameters' | translate}}</label>
          <input placeholder="paramNameFirst, paramNameSecond" class="form-control" title="" [(ngModel)]="step.sqlSavedParameter"/>
          <label>{{'Sql query' | translate}}</label>
          <input placeholder="select fieldFirst, fieldSecond from myTable" class="form-control" title="" [(ngModel)]="step.sql"/>
        </div>
        <div *ngIf="tab == 'mockServiceResponse' || tab == 'all'">
          <div class="row" *ngFor="let mockServiceResponse of step.mockServiceResponseList">
            <div class="col-sm-1">
              <button class="btn btn-sm btn-default" style="line-height: 1.9;" (click)="removeMockServiceResponse(mockServiceResponse)"><span class="glyphicon glyphicon-minus"></span> {{'Remove' | translate}}</button>
            </div>
            <div class="col-sm-11">
              <app-mock-service-response [mockServiceResponse]="mockServiceResponse"></app-mock-service-response>
            </div>
          </div>
          <button class="btn btn-sm btn-default" (click)="addMockServiceResponse()"><span class="glyphicon glyphicon-plus"></span> {{'Add mock' | translate}}</button>
        </div>
        <div *ngIf="tab == 'expectedServiceRequestList' || tab == 'all'">
          <div class="row" style="margin-bottom: 40px;" *ngFor="let expectedServiceRequest of step.expectedServiceRequestList">
            <div class="col-sm-12">
              <div class="input-group" style="margin-bottom: 5px;">
                <input placeholder="{{'Service name' | translate}} *" class="form-control" title="" [style.border-color]="expectedServiceRequest.serviceName ? '' : 'red'" [(ngModel)]="expectedServiceRequest.serviceName"/>
                <span class="input-group-btn">
                  <button class="btn" (click)="removeExpectedServiceRequest(expectedServiceRequest)"><span class="glyphicon glyphicon-minus"></span> {{'Remove' | translate}}</button>
                </span>
              </div>
              <div class="row">
                <div class="col-sm-12">
                  <input class="form-control" placeholder="{{'Ignored tags' | translate}}" style="margin-bottom: 5px;" title="" [(ngModel)]="expectedServiceRequest.ignoredTags"/>
                </div>
              </div>
              <textarea class="form-control" placeholder="{{'Expected request' | translate}}" title="" rows="7" [(ngModel)]="expectedServiceRequest.expectedServiceRequest"></textarea>
            </div>
          </div>
          <button class="btn btn-default" (click)="addExpectedServiceRequest()"><span class="glyphicon glyphicon-plus"></span> {{'Add expected mock request' | translate}}</button>
        </div>
        <div *ngIf="tab == 'mq' || tab == 'all'">
          <div class="row">
            <div class="col-sm-12">
              <label>{{'Queue name' | translate}}</label>
              <input title="{{'Queue name' | translate}}" class="form-control" [(ngModel)]="step.mqName"/>
            </div>
            <div class="col-sm-12">
              <label>{{'Queue message' | translate}}</label>
              <textarea class="form-control" placeholder="{{'Queue message' | translate}}" title="" rows="7" [(ngModel)]="step.mqMessage"></textarea>
            </div>
          </div>
        </div>
        <div *ngIf="tab == 'mqMockResponseList'">
          <div class="row" *ngFor="let mqMockResponse of step.mqMockResponseList">
            <div class="col-sm-1">
              <button class="btn btn-sm btn-default" style="line-height: 1.9;" (click)="removeMqMockResponse(mqMockResponse)"><span class="glyphicon glyphicon-minus"></span> {{'Remove' | translate}}</button>
            </div>
            <div class="col-sm-11">
              <app-mq-mock-response [mqMockResponse]="mqMockResponse"></app-mq-mock-response>
            </div>
          </div>
          <button class="btn btn-sm btn-default" (click)="addMqMockResponse()"><span class="glyphicon glyphicon-plus"></span> {{'Add MQ mock' | translate}}</button>
        </div>
        <div *ngIf="tab == 'expectedMqRequests'">
          <div class="row" style="margin-bottom: 40px;" *ngFor="let expectedMqRequest of step.expectedMqRequestList">
            <div class="col-sm-12">
              <div class="input-group" style="margin-bottom: 5px;">
                <input placeholder="{{'Source queue name' | translate}} *" class="form-control" title="" [style.border-color]="expectedMqRequest.sourceQueue ? '' : 'red'" [(ngModel)]="expectedMqRequest.sourceQueue"/>
                <span class="input-group-btn">
                  <button class="btn" (click)="removeExpectedMqRequest(expectedMqRequest)"><span class="glyphicon glyphicon-minus"></span> {{'Remove' | translate}}</button>
                </span>
              </div>
              <div class="row">
                <div class="col-sm-12">
                  <input class="form-control" placeholder="{{'Ignored tags' | translate}}" style="margin-bottom: 5px;" title="" [(ngModel)]="expectedMqRequest.ignoredTags"/>
                </div>
              </div>
              <textarea class="form-control" placeholder="{{'Expected MQ request' | translate}}" title="" rows="7" [(ngModel)]="expectedMqRequest.requestBody"></textarea>
            </div>
          </div>
          <button class="btn btn-default" (click)="addExpectedMqRequest()"><span class="glyphicon glyphicon-plus"></span> {{'Add expected mock MQ request' | translate}}</button>
        </div>
        <div *ngIf="tab == 'polling' || tab == 'all'">
          <div class="row">
            <div class="col-sm-2">
              <label>
                <input type="checkbox" title="Use polling" [(ngModel)]="step.usePolling"/>
                {{'Use polling' | translate}}
              </label>
            </div>
            <div class="col-sm-10">
              <label>{{'Polling' | translate}} json xpath:</label>
              <input placeholder="$.body.items" class="form-control" title="{{'Polling' | translate}} json xpath" [(ngModel)]="step.pollingJsonXPath" />
              <div class="help-block">{{'Waiting for json element exists. Example' | translate}}: $.body.items</div>
            </div>
          </div>
        </div>
        <div *ngIf="tab == 'parameterSet' || tab == 'all'">
          <app-step-parameter-set [stepParameterSetList]="step.stepParameterSetList"></app-step-parameter-set>
        </div>
        <div *ngIf="tab == 'json'"><pre>{{step | json}}</pre></div>
        <div *ngIf="tab == 'parse-mock-requests'">
          <div class="row">
            <div class="col-sm-12">
              <label>{{'Mock URL' | translate}}</label>
              <input title="{{'Mock URL' | translate}}" class="form-control" [(ngModel)]="step.parseMockRequestUrl"/>
            </div>
            <div class="col-sm-12">
              <label>{{'XML XPath' | translate}}</label>
              <input title="{{'XML XPath' | translate}}" class="form-control" [(ngModel)]="step.parseMockRequestXPath"/>
            </div>
            <div class="col-sm-12">
              <label>{{'Scenario variable name' | translate}}</label>
              <input title="{{'Scenario variable name' | translate}}" class="form-control" [(ngModel)]="step.parseMockRequestScenarioVariable"/>
            </div>
          </div>
        </div>
        <div *ngIf="tab == 'scenarioVariables' || tab == 'sql' || tab == 'all'">
          <div class="row">
            <div class="col-sm-12">
              <hr/>
              <label>{{'Check scenario variables' | translate}}</label>
            </div>
          </div>
          <div class="row" *ngFor="let checkedValueName of (step.savedValuesCheck ? Object.keys(step.savedValuesCheck) : [])">
            <div class="col-sm-4" style="text-align: right;">
              <label>
                <a href="#" (click)="updateCheckedValueName(checkedValueName)">{{checkedValueName}} <small><span class="glyphicon glyphicon-edit"></span></small></a>
              </label>
            </div>
            <div class="col-sm-8">
              <div class="input-group">
                <input placeholder="{{'Checked value' | translate}}" title="" class="form-control" [(ngModel)]="step.savedValuesCheck[checkedValueName]"/>
                <span class="input-group-btn">
                  <button class="btn btn-default" (click)="removeCheckedValue(checkedValueName)"><span class="glyphicon glyphicon-minus"></span> {{'Remove' | translate}}</button>
                </span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <button class="btn btn-default" (click)="addCheckedValue()"><span class="glyphicon glyphicon-plus"></span> {{'Add' | translate}}</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
